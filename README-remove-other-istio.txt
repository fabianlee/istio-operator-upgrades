
#
# To remove the OOTB istio that comes with Anthos 1.4 and replace with a full 1.6.6 istio operator
#

# remove my istio components
cd ~/k8s
kubectl delete -f istio-ootb/my-istio-virtualservice.yaml
kubectl delete -f istio-ootb/istio-autogenerated-k8s-ingress.yaml
kubectl delete -f istio/my-service-for-istio.yaml

# remove ootb istio components
cd ~/k8s/istio-ootb
./delete-istio-ootb-components.sh

# create tls key/cert, k8s TLS secret, istio gateway using secret
cd ~/k8s/istio
./make-self-signed-cert.sh


kubectl create ns istio-system
cd ~/k8s/istio-operator
./create-k8s-tls-secret.sh
cd ~/k8s


#
# TO remove k3s 1.9.7 operator from k3s playbook
#
cd istio-operator-upgrades
export rootdir=$(realpath .)
export istiover=1.9.7
curl -L https://istio.io/downloadIstio | ISTIO_VERSION=$istiover sh -
# leave istio-operator and istio-system namespace so TLS secret not deleted
./delete-revisioned-controlplane.sh istio-$istiover/bin/istioctl 1.9.7





